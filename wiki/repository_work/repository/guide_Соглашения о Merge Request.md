# Соглашения о Merge Request (MR)

<!-- TOC -->
* [Соглашения о Merge Request (MR)](#соглашения-о-merge-request--mr-)
  * [Обозначения](#обозначения)
  * [Критерии создания MR](#критерии-создания-mr)
  * [Создание MR](#создание-mr)
    * [MR должен быть как можно меньше](#mr-должен-быть-как-можно-меньше)
    * [MR должен быть маленьким, но самодостаточным](#mr-должен-быть-маленьким-но-самодостаточным)
  * [Критерии принятия MR](#критерии-принятия-mr)
<!-- TOC -->

---

## Обозначения

Данный раздел посвящен вопросам создания Merge Request (далее - MR). Цель MR соединить результаты разработки отдельных участников процесса с основным кодом без конфликтов и ошибок для всего проекта.

Порядок работы с MR выглядит следующим образом (Р-разработчик, О-ответственный):

1. (Р): Оценить требуется ли открыть MR;
2. (Р): Открыть MR и описать его;
3. (О): Получить обратную связь от ответственного за code-review или проект;
4. (Р): Устранить замечания, вернуться к п.3 до тех пор, пока не будут решены все вопросы;
5. (О): Закрыть MR.

## Критерии создания MR

Если вы считаете, что достигли завершенного состояния, когда ваш код:

**→ Оно не имеет явных ошибок.**

Ревью может выявить недочеты, которые видны без запуска проекта.\
Обычно это:

- опечатки;
- ошибки, возникшие из-за недостаточного погружения в контекст проекта;
- необновленный конфигурационный файл.

**→ Не затрагивает код, выходящий за рамки задачи.**

Решение должно быть выполнено в рамках определнной задачи. Если разработчик заметил, что можно выполнить рефакторинг другого класса, это лучше сделать в отдельном MR.

**→ Соответствует стайл-гайдам, принятым в команде.**

Проверить общепринятые практики по стайл-гайду.

**→ Пропущено через линтеры, используемые в проекте.**

Код должен пройти через ``pre-commit`` — так при каждом коммите код прогоняется через линтеры.

**→ Обладает хорошей читаемостью и пояснением неочевидных мест.**

Лучшая практика в разработке — написание самодокументируемого кода. Если по каким-то причинам ей воспользоваться не получается, советуем оставить поясняющий комментарий: он расскажет ревьюеру, что происходит в этом месте проекта.

**→ Если на проекте пишутся автотесты, решение должно ими покрываться.**

Команда принимает решение об использовании автотестов для увеличения надежности сервиса. Если эта практика уже используется, ее стоит поддерживать.

**→ Нет оверинжениринга (кода «на будущее»).**

Часто код, который решает еще не возникшие проблемы, не пригождается и становится лишним.

## Создание MR

При создании MR необходимо указать его описание
- заголовок ``#[Ticket_ID] MR description``;
- тело MR - краткое описание того, что было выполнено;
- назначается **assignee** (ответственный за MR) и **reviewer** (ответственный за проверку).

В первой строчке (в заголовке) должно быть одной фразой описано, что было сделано в MR. Причем по традиции применяется императивный (повелительный) стиль, т.е. ***Delete blablabla***, а не ***Deleting blablabla***

Само описание должно быть информативным, содержать краткое описание решаемой проблемы, ссылки на необходимые документы (если нужно), задачи таск трекера и другой контекст. Даже в маленьком MR что-то такое должно быть.

Описание типа "Fix bug" считается неверным.

### MR должен быть как можно меньше

- маленький MR можно быстро проверить;
- проверка будет более осмысленной;
- меньше вероятность упустить баг;
- проще вливать изменения, меньше конфликтов;
- легче добиться хорошего качества кода;
- чем больше изменений за раз, тем сложнее откатывать код при такой необходимости.

### MR должен быть маленьким, но самодостаточным

- Всё, что необходимо ревьюеру для понимания MR, должно быть в этом MR.
- После вливания кода система должна функционировать нормально.
- Если добавляется метод API, в этом же MR должны быть продемонстрированы и способы его использования.
- Покрывайте код тестами, причем тесты должны быть в этом же MR (если тесты приняты в проекте).

## Критерии принятия MR

Чтобы убедиться, что ваш запрос на слияние может быть одобрен, пожалуйста, убедитесь, что он соответствует приведенным ниже критериям принятия вклада:

1. Изменения настолько малы, насколько это возможно.
2. Если запрос на слияние содержит более 500 изменений:
    - объясните причину;
    - укажите сопровождающего;
    - укажите любые существенные критические изменения.
1. Включите надлежащие тесты и сделайте так, чтобы все тесты прошли успешно (если только он не содержит тест, выявляющий ошибку в существующем коде). Каждый новый класс должен иметь соответствующие модульные тесты, даже если класс выполняется на более высоком уровне, например, функциональный тест.
2. Если кажется, что неудачная сборка CI не связана с вашим вкладом, вы можете попробовать перезапустить неудачное задание CI, выполнив перезагрузку поверх целевой ветви, чтобы внести обновления, которые могут устранить сбой, или, если он еще не был исправлен, попросите разработчика помочь вам исправить тест.
3. MR содержит несколько логически организованных коммитов или имеет разрешенное сжатие коммитов (git squash).
4. Изменения могут быть объединены без конфликтов. Если такое невозможно, то вам следует выполнить повторный запрос на MR и разрешить конфликт локально или попросить совета у держателя репозитория. Если вы единственный, кто работает над вашей веткой, то в противном случае объедините эту ветку с веткой на MR.
5. Исправлена только одна конкретная проблема или реализована одна конкретная функция. Не объединяйте вещи; отправляйте отдельные запросы на слияние для каждой проблемы или функции.
6. Миграции должны выполнять только одно действие (например, создавать таблицу, перемещать данные в новую таблицу или удалять старую таблицу), чтобы облегчить повторную попытку при сбое.
7. Содержит функциональность, от которой выиграют другие пользователи.
8. Решены все вопросы, возникшие в рамках обсуждения MR.
