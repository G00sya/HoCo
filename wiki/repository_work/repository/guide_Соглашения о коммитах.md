# Соглашения о коммитах

<!-- TOC -->
* [Соглашения о коммитах](#соглашения-о-коммитах)
  * [Обозначения](#обозначения)
  * [Заголовок](#заголовок)
    * [Тип коммита `<type>`](#тип-коммита-type)
    * [Область действия коммита `<scope>`](#область-действия-коммита-scope)
    * [Заголовок коммита `<subject>`](#заголовок-коммита-subject)
      * [Пример:](#пример-)
      * [Пример:](#пример--1)
      * [Примечание:](#примечание-)
      * [Пример (на русском)](#пример--на-русском-)
      * [Например](#например)
    * [Тело коммита `<body>`](#тело-коммита-body)
      * [Пример:](#пример--2)
      * [Примеры](#примеры)
    * [Колонтитул коммита `<footer>`](#колонтитул-коммита-footer)
  * [Примеры](#примеры-1)
    * [Добавление новой функциональности](#добавление-новой-функциональности)
    * [Исправление ошибки](#исправление-ошибки)
    * [Сообщение коммита с описанием и сноской ``BREAKING CHANGE``](#сообщение-коммита-с-описанием-и-сноской-breaking-change)
    * [Сообщение коммита с ``!`` для привлечения внимания к ``BREAKING CHANGE``](#сообщение-коммита-с--для-привлечения-внимания-к-breaking-change)
    * [Сообщение коммита с контекстом и ``!`` для привлечения внимания к ``BREAKING CHANGE``](#сообщение-коммита-с-контекстом-и--для-привлечения-внимания-к-breaking-change)
    * [Сообщение коммита вместе с ``!`` и сноской ``BREAKING CHANGE``](#сообщение-коммита-вместе-с--и-сноской-breaking-change)
    * [Сообщение коммита без тела](#сообщение-коммита-без-тела)
    * [Сообщение коммита с контекстом](#сообщение-коммита-с-контекстом)
    * [Сообщение коммита с телом из нескольких абзацев и несколькими сносками](#сообщение-коммита-с-телом-из-нескольких-абзацев-и-несколькими-сносками)
  * [Pre-commit](#pre-commit)
  * [FAQ (часто задаваемые вопросы)](#faq--часто-задаваемые-вопросы-)
    * [Как мне поступать с сообщениями коммитов на начальном этапе разработки?](#как-мне-поступать-с-сообщениями-коммитов-на-начальном-этапе-разработки)
    * [Типы в заголовке коммита должны быть прописными или строчными?](#типы-в-заголовке-коммита-должны-быть-прописными-или-строчными)
    * [Что мне делать, если коммит соответствует более чем одному типу?](#что-мне-делать-если-коммит-соответствует-более-чем-одному-типу)
    * [Разве это не препятствует интенсивной разработке и быстрой итерации?](#разве-это-не-препятствует-интенсивной-разработке-и-быстрой-итерации)
    * [Может ли «Соглашение о коммитах» привести разработчиков к ограничению типов совершаемых ими коммитов, потому что они будут думать в соответствии с предоставленными типами?](#может-ли-соглашение-о-коммитах-привести-разработчиков-к-ограничению-типов-совершаемых-ими-коммитов-потому-что-они-будут-думать-в-соответствии-с-предоставленными-типами)
    * [Как это связано с Семантическим Версионированием?](#как-это-связано-с-семантическим-версионированием)
    * [Как мне довести свои расширения до спецификации «Соглашение о коммитах». Например, ``@jameswomack/standard-commit-spec``?](#как-мне-довести-свои-расширения-до-спецификации-соглашение-о-коммитах-например-jameswomackstandard-commit-spec-)
    * [Что мне делать, если я случайно использовал неправильный тип коммита?](#что-мне-делать-если-я-случайно-использовал-неправильный-тип-коммита)
      * [Когда вы использовали неправильный тип, но соответствующий в спецификации. Например, ``fix`` вместо ``feat``](#когда-вы-использовали-неправильный-тип-но-соответствующий-в-спецификации-например-fix-вместо-feat)
      * [Когда вы использовали тип, не указанный в спецификации. Например, ``feet`` вместо ``feat``](#когда-вы-использовали-тип-не-указанный-в-спецификации-например-feet-вместо-feat)
    * [Все ли мои участники должны использовать спецификацию «Соглашения о коммитах»?](#все-ли-мои-участники-должны-использовать-спецификацию-соглашения-о-коммитах)
    * [Как «Соглашение о коммитах» обрабатывает отмену коммитов?](#как-соглашение-о-коммитах-обрабатывает-отмену-коммитов)
      * [Пример:](#пример--3)
<!-- TOC -->

---

## Обозначения

Как писать сообщения коммитов (сообщение при фиксации кода в систему хранения версий кода), которые удобны для чтения людьми и машинами.
В итоге это может дать нам возможность автоматически генерировать Changelog, и автоматически выпускать новые версии при добавлении возможностей.

За основу взято соглашение https://www.conventionalcommits.org/ru/v1.0.0-beta.4/

Для оформления сообщения коммита следует использовать следующий шаблон:

```
<type>[(<scope>)][!]: <subject>
<BLANK LINE>
[<body>]
<BLANK LINE>
[<footer>]
```

- **type** - тип коммита;
- **scope** - необязательная область действия коммита subject - заголовок коммита;
- **body** - необязательное тело коммита;
- **footer** - необязательный колонтитул;
- **!** - пометка о нарушении обратной совместимости.

1. Коммиты должны начинаться с типа `<type>`, далее в скобках следует необязательный контекст `<scope>` (т.е. область действия коммита), дальше идет двоеточие, пробел и заголовок коммита `<subject>`. Тело коммита `<body>` отделяется пустой строкой от заголовка и от необязательного колонтитула `<footer>`.
2. Коммиты оформляются на английском языке.
3. Коммиты с восклицательным (!) знаком, являются признаком того, что внесены изменения нарушающие обратную совместимость версий.


## Заголовок

### Тип коммита `<type>`

Возможные типы:

* **feat** - используется при добавлении новой функциональности уровня
  приложения (необходимо изменить MINOR версию приложения);
* **fix** - если исправили какую-то серьезную ошибку (bug, необходимо изменить PATCH версию приложения);
* **docs** - всё, что касается документации;
* **style** - исправляем опечатки, исправляем форматирование кода, переименование переменных/типов/классов/констант, добавили комментарии;
* **refactor** - рефакторинг кода приложения, улучшение кода без изменения
  функциональности;
* **test** - всё, что связано с тестированием;
* **chore** - обычное обслуживание кода, например переместили файл, удалили зависимость в проекте;
* **revert** - отмена изменений;
* **update** - обновление информации или требований (чаще всего может понадобиться в jupyter, для изменения описания в разделах, например расширение требований).

Можно указывать несколько типов через запятую.

При необходимости типы коммитов могут быть расширены.

### Область действия коммита `<scope>`

Область действия коммита описывает часть кодовой базы которую затронул коммит, например fix(parser)... Т.е. ошибка была исправлена в части кода ответственной за парсинг.

Здесь следует написать затронутые части (например, `apiserver`
или `руководство оператора`)

### Заголовок коммита `<subject>`

1. Заголовок коммита должен начинаться с прописной (заглавной) буквы.
2. Заголовок не должен превышать 50 символов в длину.
3. Точка в конце заголовка коммита не ставится.
4. Текст заголовка должен использовать повелительное наклонение, т.е. заголовок должен быть похожим на команду или инструкцию. На русском языке повелительное наклонение выглядит не очень презентабельно, но в английском это вполне естественно.

#### Пример:
```
- Добавить функцию преобразования набора данных в методы класса (Add dataset transformation function to class methods);
- Исправить ошибку обнуления весов в модели (Fix weight zeroing error in model).
```

5. Сообщения коммитов описывают, что конкретно делают зафиксированные изменения, а не то, что было сделано. Повелительное наклонение отлично подходит для описания заголовков коммитов.

#### Пример:
```
- Создать функцию предобработки данных (Create a data preprocessing function);
- Разработать методы настройки гиперпараметров (Develop hyperparameter tuning methods).
```

#### Примечание:
```
- Рекомендуем писать сообщения коммитов так, как будто вы уже выпустили продукт. Как правило, кто-то, например, ваши коллеги, уже используют ваш код. И они хотят знать, что исправилось, что изменилось, какие нарушения обратной совместимости появились и т.д.
- Если один коммит содержит несколько изменений, лучше разбить его на несколько, если это возможно.
- Что мне делать, если я случайно использовал не тот тип коммита? Измените сообщение лога (для SVN). Для GIT отредактировать историю `git rebase -i`.
```

6. Лучше написать грамотно по-русски, чем неграмотно по-английски!

Общий стиль описания:
```
действие (с маленькой буквы) + для какой сущности + (необязательно подробности)
```
#### Пример (на русском)
```
исправление ошибки NoMethodError в RemoteReader'е
```
7. Первое слово - отглагольное существительное.

8. Не писать в сообщении номер задачи из Redmine или Trac - для этого есть тело коммита (см. далее).

#### Например
```
исправление(eventlog): исправлено сохранение события в базу данных
документы(все): исправлены опечатки в фамилии исполнителя
стиль(js): выполнено форматирование кода, исправлены опечатки в именах переменных
```
### Тело коммита `<body>`

1. Заполнение тела коммита опционально. Нужно в том случае, если описание решенной проблемы достаточно сложно и не может уместиться в строку заголовка.
2. В тело можно писать номер закрываемого (закрываемых) тасков из Redmine или Trac.
3. Тело сообщения отделяется от заголовка одной пустой строкой и заполняется произвольно.
4. Тело может содержать указание на наличие изменения, ведущего к обратной несовместимости с предыдущей версией. Это отмечается указанием в начале строки фразы "ВАЖНОЕ ИЗМЕНЕНИЕ:" далее указывается то, что изменилось в API приложения. Наличие важного изменения говорит о необходимости изменить MAJOR версию продукта.
5. Если вы ссылаетесь на задачу в Redmine или Trac, указываете другую мета информацию, то размещайте ее построчно. Одна единица информации - одна строка.
6. В теле описания коммита отвечайте на вопросы **"что?"** и **"почему?"**, а не **"как?"**.

#### Пример:
```
- Добавить функцию преобразования хвостов распределения в средние значения, для решения проблемы выбросов (Add a function to convert distribution tails to averages, to solve the problem of outliers).
- Создать класс обертку набора данных. Необходим более динамический доступ к набору данных, с максимально изменяемыми параметрами (Create a dataset wrapper class. More dynamic access to the dataset is needed, with parameters that change as much as possible)
```

1. Текст тела колонтитула не должен превышать в ширину 72 символа на одну строку. После достижения максимальной длины, нужно осуществить перенос на другую строку.

#### Примеры

*Сообщение без указания области*
```
исправление: устранены незначительные ошибки в коде
```

*Сообщение с указанием области*

```
исправление(eventlog): исправлено сохранение события в базу данных
```
*Сообщение с дополнительной информацией о задаче*
```
исправление(eventlog): исправлено сохранение события в базу данных
закрывает #2014
Обсуждение тут http://####.xx/sss
```
*Сообщение о важном изменении, ломающим обратную совместимость*
```
Возможность(прокладчик тракта): изменена структура базы данных для обеспечения создания нескольких связей между соседями

ВАЖНОЕ ИЗМЕНЕНИЕ: в структуре базы данных изменилась структура, необходимо выполнить ручное обновление и проверку данных после

Инструкция по обновлению: обновите базу данных скриптом, затем запуститие скрипт update_links.bat,в файле отчет проверьте какие связи нужно создать заново вручную.
```
### Колонтитул коммита `<footer>`

В последней части коммита - колонтитуле нужно указывать дополнительную информацию:

- Ссылка на полную задачу в Jira
- Ссылка на подзадачу в Jira

## Примеры

### Добавление новой функциональности

![](docs/commit-ex2.png)

### Исправление ошибки

![](docs/commit-ex1.png)

### Сообщение коммита с описанием и сноской ``BREAKING CHANGE``

```
feat: allow provided config object to extend other configs

BREAKING CHANGE: `extends` key in config file is now used for extending
other config files
```

### Сообщение коммита с ``!`` для привлечения внимания к ``BREAKING CHANGE``

```
feat!: send an email to the customer when a product is shipped
```

### Сообщение коммита с контекстом и ``!`` для привлечения внимания к ``BREAKING CHANGE``

```
feat(api)!: send an email to the customer when a product is shipped
```

### Сообщение коммита вместе с ``!`` и сноской ``BREAKING CHANGE``

```
chore!: drop support for Node 6

BREAKING CHANGE: use JavaScript features not available in Node 6.
```

### Сообщение коммита без тела

```
docs: correct spelling of CHANGELOG
```

### Сообщение коммита с контекстом

```
feat(lang): add polish language
```

### Сообщение коммита с телом из нескольких абзацев и несколькими сносками

```
fix: prevent racing of requests

Introduce a request id and a reference to latest request. Dismiss
incoming responses other than from latest request.

Remove timeouts which were used to mitigate the racing issue but are
obsolete now.

Reviewed-by: Z
Refs: #123
```

## Pre-commit

Важным элементом коммитов является автоматическое формирование кода под стандарты проекта. Если на вашем проекте установлены файлы для pre-commits, то им необходимо следовать перед отправкой коммита.

Процесс **pre-commit** может быть запущен до [MR](#соглашения-о-merge-request-(mr)). Важно, чтобы он прошел **до момента проверки вашего кода другим участником** на [Code review](#соглашения-о-code-review)

Подробнее о pre-commit указано в [документации](pre-commit%2Fpre-commit.md).


## FAQ (часто задаваемые вопросы)

### Как мне поступать с сообщениями коммитов на начальном этапе разработки?

Мы рекомендуем действовать так, как если бы вы уже выпустили продукт. Обычно кто-то, даже если это ваши коллеги-разработчики программного обеспечения, использует ваше программное обеспечение. Они захотят знать, что исправлено, что ломается и т. д.

### Типы в заголовке коммита должны быть прописными или строчными?

Выберите тот, который больше всего вам нравится, и строго ему следуйте.

### Что мне делать, если коммит соответствует более чем одному типу?

По возможности вернитесь назад и сделайте несколько коммитов. Часть преимущества «Соглашения о коммитах» - его способность побуждать нас делать более организованные коммиты и PRs (pull requests, или запросы на вытягивание).

### Разве это не препятствует интенсивной разработке и быстрой итерации?

Это препятствует быстрому неорганизованному движению. Это поможет вам быстро продвигаться в долгосрочной перспективе в нескольких проектах с разными участниками.

### Может ли «Соглашение о коммитах» привести разработчиков к ограничению типов совершаемых ими коммитов, потому что они будут думать в соответствии с предоставленными типами?

«Соглашение о коммитах» побуждает нас делать больше определённых типов коммитов, таких, как ``fix``. Помимо этого, гибкость «Соглашения о коммитах» позволяет вашей команде придумывать свои собственные типы и со временем изменять их.

### Как это связано с Семантическим Версионированием?

Коммиты типа ``fix`` должны быть переведены в выпуски ``PATCH``, ``feat`` — в ``MINOR``, ``BREAKING CHANGE``, независимо от типа, — в ``MAJOR``.

### Как мне довести свои расширения до спецификации «Соглашение о коммитах». Например, ``@jameswomack/standard-commit-spec``?

Мы рекомендуем использовать Семантическое Версионирование для выпуска ваших собственных расширений для этой спецификации (и призываем вас создавать эти расширения!).

### Что мне делать, если я случайно использовал неправильный тип коммита?

#### Когда вы использовали неправильный тип, но соответствующий в спецификации. Например, ``fix`` вместо ``feat``

Перед объединением или выпуском ошибки мы рекомендуем использовать ``git rebase -i`` для редактирования истории коммитов. После выпуска редактирование будет отличаться в зависимости от того, какие инструменты и процессы вы используете.

#### Когда вы использовали тип, не указанный в спецификации. Например, ``feet`` вместо ``feat``

В худшем случае это ещё не конец света, если коммит не соответствует спецификации «Соглашения о коммитах». Это просто означает, что коммит будет пропущен инструментами, основанными на спецификации.

### Все ли мои участники должны использовать спецификацию «Соглашения о коммитах»?

Нет! Если вы используете рабочий процесс на основе соединения (squash) коммитов в Git, то ведущие специалисты по сопровождению могут приводить в порядок сообщения коммитов по мере их слияния (merge), не добавляя нагрузки для обычных коммиттеров. Обычный рабочий процесс для этого состоит в том, чтобы ваша система Git автоматически соединяла коммиты
из PR и представляла форму для ведущего сопровождающего, чтобы ввести более подходящее сообщение коммита для слияния.

### Как «Соглашение о коммитах» обрабатывает отмену коммитов?

Отмена изменений кода может быть сложной:

Вы отменяете изменения нескольких коммитов? Если вы отмените изменения новых функций, должен ли следующий выпуск быть патчем? «Соглашение о коммитах» не делает явных попыток определить поведение отмены изменений. Вместо этого мы оставляем авторам инструментов использование гибкости типов и сносок для разработки своей логики для обработки отмены изменений.

Одна из рекомендаций — использовать тип ``revert`` и сноску, которая ссылается на отменяемые хэш-суммы коммитов.
#### Пример:
```
revert: let us never again speak of the noodle incident

Refs: 676104e, a215868
```
